# æ‰¹é‡ä¸²è¡Œè®­ç»ƒä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

`run_yolo_batch.sh` è„šæœ¬å¯ä»¥è®©ä½ åœ¨**åå°ä¸²è¡Œæ‰§è¡Œå¤šä¸ªè®­ç»ƒä»»åŠ¡**ï¼Œå®Œç¾ç»“åˆäº†ï¼š
- âœ… åå°è¿è¡Œï¼ˆå¯å…³é—­ç»ˆç«¯ï¼‰
- âœ… ä¸²è¡Œæ‰§è¡Œï¼ˆé¿å… GPU å†…å­˜ä¸è¶³ï¼‰
- âœ… è‡ªåŠ¨åŒ–ï¼ˆæ— éœ€äººå·¥å¹²é¢„ï¼‰

## ğŸš€ åŸºæœ¬ç”¨æ³•

```bash
./run_yolo_batch.sh <batch_name> <task1_args> -- <task2_args> [-- <task3_args> ...]
```

**é‡è¦è§„åˆ™ï¼š**
- ä½¿ç”¨ `--` åˆ†éš”ä¸åŒçš„è®­ç»ƒä»»åŠ¡
- æ¯ä¸ªä»»åŠ¡å¿…é¡»åŒ…å« `--name` å‚æ•°
- ä»»åŠ¡ä¼šæŒ‰é¡ºåºä¸²è¡Œæ‰§è¡Œ

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå¯¹æ¯”ä¸¤ä¸ªå­¦ä¹ ç‡

```bash
./run_yolo_batch.sh lr_compare \
    --name lr0.001 --lr0 0.001 --epochs 100 -- \
    --name lr0.0005 --lr0 0.0005 --epochs 100
```

**æ‰§è¡Œæµç¨‹ï¼š**
1. å…ˆè®­ç»ƒ `lr0.001` (100 epochs)
2. å®Œæˆåè‡ªåŠ¨å¼€å§‹è®­ç»ƒ `lr0.0005` (100 epochs)
3. æ‰€æœ‰æ—¥å¿—ä¿å­˜åˆ° `lr_compare.log`

### ç¤ºä¾‹ 2ï¼šå¯¹æ¯”æ•°æ®å¢å¼ºæ•ˆæœ

```bash
./run_yolo_batch.sh augment_compare \
    --name baseline --epochs 200 -- \
    --name with_augment --augment --epochs 200
```

### ç¤ºä¾‹ 3ï¼šå¯¹æ¯”ä¸åŒ Batch Size

```bash
./run_yolo_batch.sh batch_size_study \
    --name bs16 --batch-size 16 --epochs 150 -- \
    --name bs32 --batch-size 32 --epochs 150 -- \
    --name bs64 --batch-size 64 --epochs 150
```

### ç¤ºä¾‹ 4ï¼šå®Œæ•´çš„æ¶ˆèå®éªŒ

```bash
./run_yolo_batch.sh ablation_study \
    --name baseline --epochs 200 -- \
    --name with_mixup --augment --mosaic 0.0 --mixup 0.3 --epochs 200 -- \
    --name with_mosaic --augment --mosaic 1.0 --mixup 0.0 --epochs 200 -- \
    --name full_augment --augment --epochs 200
```

### ç¤ºä¾‹ 5ï¼šä¼˜åŒ–å™¨å¯¹æ¯”

```bash
./run_yolo_batch.sh optimizer_compare \
    --name adam_001 --optimizer Adam --lr0 0.001 --epochs 150 -- \
    --name adam_0005 --optimizer Adam --lr0 0.0005 --epochs 150 -- \
    --name sgd_001 --optimizer SGD --lr0 0.001 --epochs 150
```

## ğŸ” ç›‘æ§è®­ç»ƒè¿›åº¦

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
tail -f lr_compare.log
```

### æŸ¥çœ‹å½“å‰è¿è¡Œçš„è®­ç»ƒä»»åŠ¡
```bash
ps aux | grep train.py
```

### æŸ¥çœ‹ GPU ä½¿ç”¨æƒ…å†µ
```bash
watch -n 1 nvidia-smi
```

### åœæ­¢æ‰¹é‡è®­ç»ƒ
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬è¾“å‡ºçš„ PID
kill <PID>

# æ–¹æ³•2ï¼šåœæ­¢æ‰€æœ‰ train.py è¿›ç¨‹
pkill -f "python train.py"
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¯ä¸ªä»»åŠ¡å¿…é¡»æœ‰ --name å‚æ•°**
   ```bash
   # âŒ é”™è¯¯ï¼ˆç¼ºå°‘ --nameï¼‰
   ./run_yolo_batch.sh test --epochs 100 -- --lr0 0.001
   
   # âœ… æ­£ç¡®
   ./run_yolo_batch.sh test --name exp1 --epochs 100 -- --name exp2 --lr0 0.001
   ```

2. **åˆ†éš”ç¬¦å¿…é¡»ç‹¬ç«‹ä½¿ç”¨**
   ```bash
   # âŒ é”™è¯¯ï¼ˆ-- è¿åœ¨å‚æ•°åé¢ï¼‰
   ./run_yolo_batch.sh test --name exp1 --epochs 100-- --name exp2
   
   # âœ… æ­£ç¡®ï¼ˆ-- å‰åæœ‰ç©ºæ ¼ï¼‰
   ./run_yolo_batch.sh test --name exp1 --epochs 100 -- --name exp2
   ```

3. **ç¡®ä¿ GPU å†…å­˜è¶³å¤Ÿ**
   - è™½ç„¶æ˜¯ä¸²è¡Œæ‰§è¡Œï¼Œä½†è¦ç¡®ä¿å•ä¸ªä»»åŠ¡ä¸ä¼šè€—å°½ GPU å†…å­˜
   - å¦‚æœå†…å­˜ä¸è¶³ï¼Œé™ä½ `--batch-size`

4. **æ—¥å¿—æ–‡ä»¶ç®¡ç†**
   - æ‰€æœ‰ä»»åŠ¡å…±äº«åŒä¸€ä¸ªæ—¥å¿—æ–‡ä»¶
   - æ—¥å¿—æ–‡ä»¶åä¸º `<batch_name>.log`
   - å»ºè®®å®šæœŸæ¸…ç†æ—§æ—¥å¿—

## ğŸ†š ä¸‰ç§è„šæœ¬å¯¹æ¯”

| ç‰¹æ€§ | `run_yolo.sh` | `run_yolo_batch.sh` | ç›´æ¥è°ƒç”¨ `python train.py` |
|------|---------------|---------------------|----------------------------|
| åå°è¿è¡Œ | âœ… | âœ… | âŒ (éœ€è¦æ‰‹åŠ¨ nohup) |
| ä¸²è¡Œæ‰§è¡Œå¤šä»»åŠ¡ | âŒ | âœ… | âœ… (ä½¿ç”¨ &&) |
| å¯å…³é—­ç»ˆç«¯ | âœ… | âœ… | âŒ (é™¤éç”¨ nohup) |
| é€‚ç”¨åœºæ™¯ | å•æ¬¡è®­ç»ƒ | æ‰¹é‡å¯¹æ¯”å®éªŒ | å¿«é€Ÿæµ‹è¯• |

## ğŸ’¡ æœ€ä½³å®è·µ

1. **è§„åˆ’å®éªŒåç§°**
   - æ‰¹é‡åç§°åº”ä½“ç°å®éªŒä¸»é¢˜ï¼š`lr_compare`, `augment_study`
   - ä»»åŠ¡åç§°åº”ä½“ç°å‚æ•°å·®å¼‚ï¼š`lr0.001`, `bs16`, `with_augment`

2. **åˆç†å®‰æ’è®­ç»ƒæ—¶é•¿**
   - å¯¹æ¯”å®éªŒå»ºè®®å…ˆç”¨è¾ƒå°‘ epochs æµ‹è¯•
   - ç¡®è®¤é…ç½®æ­£ç¡®åå†è¿›è¡Œå®Œæ•´è®­ç»ƒ

3. **ç›‘æ§é¦–ä¸ªä»»åŠ¡**
   ```bash
   # å¯åŠ¨æ‰¹é‡è®­ç»ƒåï¼Œç«‹å³æŸ¥çœ‹æ—¥å¿—
   ./run_yolo_batch.sh my_exp ... &
   tail -f my_exp.log
   ```

4. **ä¿å­˜å®éªŒè®°å½•**
   ```bash
   # åœ¨æ—¥å¿—ä¸­è®°å½•å®éªŒç›®çš„
   echo "å®éªŒç›®çš„ï¼šå¯¹æ¯”å­¦ä¹ ç‡ 0.001 vs 0.0005" >> lr_compare.log
   ./run_yolo_batch.sh lr_compare ...
   ```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šè„šæœ¬ç«‹å³é€€å‡º
```bash
# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶
cat <batch_name>.log

# å¸¸è§åŸå› ï¼š
# - æ•°æ®é›†è·¯å¾„é”™è¯¯
# - æ¨¡å‹é…ç½®æ–‡ä»¶ä¸å­˜åœ¨
# - Python ç¯å¢ƒé—®é¢˜
```

### é—®é¢˜ï¼šç¬¬äºŒä¸ªä»»åŠ¡æ²¡æœ‰å¼€å§‹
```bash
# æ£€æŸ¥ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯å¦æˆåŠŸå®Œæˆ
grep "Training complete" <batch_name>.log

# å¦‚æœç¬¬ä¸€ä¸ªä»»åŠ¡å¤±è´¥ï¼Œæ•´ä¸ªæ‰¹é‡è®­ç»ƒä¼šç»ˆæ­¢
```

### é—®é¢˜ï¼šæ— æ³•æ‰¾åˆ°æ—¥å¿—æ–‡ä»¶
```bash
# æ—¥å¿—æ–‡ä»¶åœ¨è„šæœ¬æ‰§è¡Œç›®å½•
ls -la *.log

# æŸ¥çœ‹æœ€è¿‘ä¿®æ”¹çš„æ—¥å¿—
ls -lt *.log | head
```

## ğŸ“Š ç»“æœåˆ†æ

è®­ç»ƒå®Œæˆåï¼Œç»“æœä¿å­˜åœ¨ï¼š
```
runs/train/
â”œâ”€â”€ lr0.001/          # ç¬¬ä¸€ä¸ªä»»åŠ¡ç»“æœ
â”‚   â”œâ”€â”€ weights/
â”‚   â”œâ”€â”€ results.csv
â”‚   â””â”€â”€ ...
â””â”€â”€ lr0.0005/         # ç¬¬äºŒä¸ªä»»åŠ¡ç»“æœ
    â”œâ”€â”€ weights/
    â”œâ”€â”€ results.csv
    â””â”€â”€ ...
```

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯¹æ¯”ç»“æœï¼š
```bash
# å¯¹æ¯”æœ€ç»ˆæŒ‡æ ‡
grep "mAP" runs/train/*/results.csv

# ä½¿ç”¨ TensorBoard å¯è§†åŒ–
tensorboard --logdir runs/train
```

