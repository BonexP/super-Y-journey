# è¾¹ç•Œæ¡†ä¸¢å¤±é—®é¢˜ä¿®å¤è¯´æ˜Ž

## é—®é¢˜æè¿°
åŽŸå§‹ä»£ç åœ¨æ•°æ®å¢žå¼ºè¿‡ç¨‹ä¸­ä¼šå‡ºçŽ°è¾¹ç•Œæ¡†ï¼ˆbboxï¼‰ä¸¢å¤±çš„é—®é¢˜ï¼Œä¸»è¦åŽŸå› ï¼š

1. **RandomCrop éšæœºè£å‰ª** - è£å‰ªæ—¶å¯èƒ½å°†è¾¹ç•Œæ¡†è£æŽ‰
2. **é»˜è®¤çš„ min_area å’Œ min_visibility é˜ˆå€¼** - Albumentations é»˜è®¤ä¼šè¿‡æ»¤æŽ‰é¢ç§¯æˆ–å¯è§åº¦è¿‡å°çš„bbox
3. **ç¼ºä¹ç»Ÿè®¡ä¿¡æ¯** - æ— æ³•äº†è§£bboxä¸¢å¤±çš„å…·ä½“æƒ…å†µ

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå®‰å…¨æ¨¡å¼ï¼ˆæŽ¨èï¼‰- `transform_safe`
**ä½¿ç”¨ Resize æ›¿ä»£ RandomCropï¼Œå®Œå…¨é¿å…è£å‰ªå¯¼è‡´çš„bboxä¸¢å¤±**

ç‰¹ç‚¹ï¼š
- âœ… **100% ä¿ç•™æ‰€æœ‰è¾¹ç•Œæ¡†**
- âœ… é€‚ç”¨äºŽå°ç›®æ ‡æ£€æµ‹ä»»åŠ¡
- âœ… é€‚ç”¨äºŽè¾¹ç•Œæ¡†è¾ƒå°‘çš„åœºæ™¯
- âœ… å¢žå¼ºæ•ˆæžœæ¸©å’Œä½†å¯é 

é…ç½®è¦ç‚¹ï¼š
```python
A.Resize(height=TARGET_SIZE, width=TARGET_SIZE, p=1.0)  # ä½¿ç”¨Resize
bbox_params=A.BboxParams(
    min_area=0,         # ä¸é™åˆ¶æœ€å°é¢ç§¯
    min_visibility=0,   # ä¸é™åˆ¶æœ€å°å¯è§åº¦
)
```

### æ–¹æ¡ˆ2ï¼šæ¿€è¿›æ¨¡å¼ - `transform_aggressive`
**ä¼˜åŒ–è£å‰ªç­–ç•¥ï¼Œå…è®¸éƒ¨åˆ†bboxä¸¢å¤±ä½†ä¿ç•™å¤§éƒ¨åˆ†**

ç‰¹ç‚¹ï¼š
- âš¡ å¢žå¼ºæ›´å¤šæ ·åŒ–
- âš¡ é€‚ç”¨äºŽå¤§ç›®æ ‡æ£€æµ‹
- âš¡ é€‚ç”¨äºŽæ¯å¼ å›¾æœ‰å¾ˆå¤šbboxçš„åœºæ™¯
- âš ï¸ å¯èƒ½ä¸¢å¤±å°‘é‡è¾¹ç•Œæ¡†

é…ç½®è¦ç‚¹ï¼š
```python
# å…ˆæ”¾å¤§å†è£å‰ªï¼Œå‡å°‘bboxä¸¢å¤±
A.Resize(height=int(TARGET_SIZE * 1.2), width=int(TARGET_SIZE * 1.2))
A.RandomCrop(height=TARGET_SIZE, width=TARGET_SIZE, p=0.5)  # é™ä½Žæ¦‚çŽ‡
bbox_params=A.BboxParams(
    min_area=16,           # è¿‡æ»¤æžå°çš„æ®‹ç•™bbox
    min_visibility=0.3,    # ä¿ç•™30%ä»¥ä¸Šå¯è§åº¦çš„bbox
)
```

## å¦‚ä½•åˆ‡æ¢æ¨¡å¼

åœ¨ä»£ç çš„ç¬¬ **114è¡Œ** å·¦å³ï¼Œä¿®æ”¹ï¼š

```python
# ä½¿ç”¨å®‰å…¨æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
transform = transform_safe

# æˆ–ä½¿ç”¨æ¿€è¿›æ¨¡å¼
# transform = transform_aggressive
```

## æ–°å¢žåŠŸèƒ½

### 1. å®žæ—¶ç»Ÿè®¡
æ¯å¤„ç†100å¼ å›¾åƒæ˜¾ç¤ºï¼š
- Bboxä¿ç•™çŽ‡
- å®Œå…¨ä¸¢å¤±çš„æ¬¡æ•°
- éƒ¨åˆ†ä¸¢å¤±çš„æ¬¡æ•°

```
å¤„ç†è¿›åº¦: 100/1000 | Bboxä¿ç•™çŽ‡: 98.5% | å®Œå…¨ä¸¢å¤±: 2 | éƒ¨åˆ†ä¸¢å¤±: 15
```

### 2. è¯¦ç»†æŠ¥å‘Š
å¤„ç†å®ŒæˆåŽæ˜¾ç¤ºï¼š
```
ðŸ“Š æ•°æ®ç»Ÿè®¡:
  - åŽŸå§‹å›¾åƒ: 1000
  - æˆåŠŸå¢žå¼º: 3000
  - å¤±è´¥æ¬¡æ•°: 5
  - æ€»å›¾åƒæ•°: 4000

ðŸ“¦ Bboxä¿ç•™ç»Ÿè®¡:
  - åŽŸå§‹bboxæ€»æ•°: 5000
  - ä¿ç•™bboxæ€»æ•°: 4925
  - æ€»ä½“ä¿ç•™çŽ‡: 98.50%
  - å®Œå…¨ä¸¢å¤±bboxçš„å¢žå¼º: 5
  - éƒ¨åˆ†ä¸¢å¤±bboxçš„å¢žå¼º: 70
```

### 3. æ™ºèƒ½é‡è¯•æœºåˆ¶
- å½“æ‰€æœ‰bboxä¸¢å¤±æ—¶ï¼Œè‡ªåŠ¨é‡è¯•æœ€å¤š5æ¬¡
- åªæœ‰åœ¨å¤šæ¬¡é‡è¯•åŽä»ç„¶å¤±è´¥æ‰è·³è¿‡è¯¥å¢žå¼º
- éƒ¨åˆ†bboxä¸¢å¤±ï¼ˆä½†ä»æœ‰ä¿ç•™ï¼‰æ—¶æ­£å¸¸ä¿å­˜

### 4. è­¦å‘Šæç¤º
```
âš ï¸ image_001_aug_1: æ‰€æœ‰ 3 ä¸ªbboxä¸¢å¤±ï¼Œè·³è¿‡æ­¤å¢žå¼º
âš ï¸ image_002_aug_2: bboxä»Ž 5 å‡å°‘åˆ° 2
```

## æŽ¨èä½¿ç”¨åœºæ™¯

### ä½¿ç”¨å®‰å…¨æ¨¡å¼ (transform_safe)
- ç„ŠæŽ¥ç¼ºé™·æ£€æµ‹ï¼ˆç¼ºé™·é€šå¸¸è¾ƒå°ï¼‰
- åŒ»ç–—å½±åƒæ£€æµ‹
- è¾¹ç•Œæ¡†æ•°é‡è¾ƒå°‘çš„åœºæ™¯
- å¯¹bboxå®Œæ•´æ€§è¦æ±‚é«˜çš„ä»»åŠ¡

### ä½¿ç”¨æ¿€è¿›æ¨¡å¼ (transform_aggressive)
- é€šç”¨ç‰©ä½“æ£€æµ‹ï¼ˆCOCOç­‰ï¼‰
- è¾¹ç•Œæ¡†æ•°é‡å¤šä¸”å°ºå¯¸å¤§çš„åœºæ™¯
- éœ€è¦æ›´å¼ºæ•°æ®å¢žå¼ºçš„ä»»åŠ¡
- å¯ä»¥å®¹å¿å°‘é‡bboxä¸¢å¤±

## éªŒè¯æ–¹æ³•

è¿è¡Œå¢žå¼ºåŽï¼Œæ£€æŸ¥ä»¥ä¸‹æŒ‡æ ‡ï¼š

1. **Bboxä¿ç•™çŽ‡** - å»ºè®® > 95%
2. **å®Œå…¨ä¸¢å¤±æ¬¡æ•°** - å»ºè®® < æ€»å¢žå¼ºæ•°çš„ 5%
3. **éšæœºæŠ½æŸ¥** - å¯è§†åŒ–å‡ å¼ å¢žå¼ºå›¾åƒå’Œå¯¹åº”æ ‡æ³¨

```python
# ç®€å•çš„éªŒè¯è„šæœ¬
import cv2
import os

def visualize_augmented(img_path, label_path):
    img = cv2.imread(img_path)
    h, w = img.shape[:2]
    
    with open(label_path, 'r') as f:
        for line in f:
            class_id, x, y, w_norm, h_norm = map(float, line.split())
            x1 = int((x - w_norm/2) * w)
            y1 = int((y - h_norm/2) * h)
            x2 = int((x + w_norm/2) * w)
            y2 = int((y + h_norm/2) * h)
            cv2.rectangle(img, (x1, y1), (x2, y2), (0, 255, 0), 2)
    
    cv2.imshow('Augmented', img)
    cv2.waitKey(0)
```

## æŠ€æœ¯ç»†èŠ‚

### Albumentations bbox_params å‚æ•°è¯´æ˜Ž

- **format='yolo'** - bboxæ ¼å¼ä¸º [x_center, y_center, width, height]ï¼Œå½’ä¸€åŒ–åˆ° [0, 1]
- **label_fields** - æŒ‡å®šç±»åˆ«æ ‡ç­¾å­—æ®µ
- **min_area** - è¿‡æ»¤é¢ç§¯å°äºŽè¯¥å€¼ï¼ˆåƒç´ Â²ï¼‰çš„bbox
- **min_visibility** - è¿‡æ»¤å¯è§åº¦å°äºŽè¯¥å€¼ï¼ˆ0-1ï¼‰çš„bbox
- **check_each_transform** - æ˜¯å¦æ¯æ­¥éƒ½æ£€æŸ¥bboxæœ‰æ•ˆæ€§ï¼ˆé»˜è®¤Trueï¼‰

### ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ RandomCropï¼Ÿ

RandomCrop çš„é—®é¢˜ï¼š
1. éšæœºè£å‰ªä½ç½®å¯èƒ½ä¸åŒ…å«ä»»ä½•bbox
2. å³ä½¿æœ‰ pad_if_needed=Trueï¼Œä»å¯èƒ½è£æŽ‰è¾¹ç¼˜çš„bbox
3. å¯¹å°ç›®æ ‡æžä¸å‹å¥½

Resize çš„ä¼˜åŠ¿ï¼š
1. ä¿è¯æ‰€æœ‰bboxéƒ½ç­‰æ¯”ä¾‹ç¼©æ”¾
2. ä¸ä¼šä¸¢å¤±ä»»ä½•ä¿¡æ¯
3. æ›´é€‚åˆå·¥ä¸šæ£€æµ‹ç­‰ç²¾åº¦è¦æ±‚é«˜çš„åœºæ™¯

## å¸¸è§é—®é¢˜ FAQ

**Q: ä¸ºä»€ä¹ˆè¿˜æ˜¯æœ‰éƒ¨åˆ†bboxä¸¢å¤±ï¼Ÿ**
A: æ£€æŸ¥ä½ ä½¿ç”¨çš„æ˜¯å“ªä¸ªæ¨¡å¼ã€‚å¦‚æžœæ˜¯ `transform_aggressive`ï¼Œéƒ¨åˆ†ä¸¢å¤±æ˜¯æ­£å¸¸çš„ï¼ˆç‰¹åˆ«æ˜¯è£å‰ªåŽåªå‰©ä¸€å°éƒ¨åˆ†çš„bboxï¼‰ã€‚å¦‚æžœæ˜¯ `transform_safe`ï¼Œç†è®ºä¸Šä¸åº”è¯¥ä¸¢å¤±ã€‚

**Q: å¢žå¼ºåŽå›¾åƒè´¨é‡å˜å·®äº†ï¼Ÿ**
A: å¯ä»¥è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š
- é™ä½Žæ¨¡ç³Šæ¦‚çŽ‡ï¼š`p=0.2` â†’ `p=0.1`
- å‡å°å™ªå£°å¼ºåº¦ï¼š`var_limit=(10.0, 50.0)` â†’ `var_limit=(5.0, 20.0)`
- å‡å°æ—‹è½¬è§’åº¦ï¼š`rotate=(-10, 10)` â†’ `rotate=(-5, 5)`

**Q: è®­ç»ƒæ—¶è¿˜éœ€è¦é¢å¤–çš„æ•°æ®å¢žå¼ºå—ï¼Ÿ**
A: è¿™ä¸ªè„šæœ¬æ˜¯**ç¦»çº¿å¢žå¼º**ï¼Œç”Ÿæˆå›ºå®šçš„å¢žå¼ºæ•°æ®é›†ã€‚YOLOè®­ç»ƒæ—¶å¯èƒ½è¿˜ä¼šæœ‰**åœ¨çº¿å¢žå¼º**ï¼ˆmosaicã€mixupç­‰ï¼‰ã€‚ä¸¤è€…å¯ä»¥é…åˆä½¿ç”¨ã€‚

**Q: å¦‚ä½•åªä½¿ç”¨æŸäº›å¢žå¼ºè€Œä¸ä½¿ç”¨å…¶ä»–çš„ï¼Ÿ**
A: ä¿®æ”¹ `transform_safe` æˆ– `transform_aggressive`ï¼Œæ³¨é‡ŠæŽ‰ä¸éœ€è¦çš„å¢žå¼ºï¼Œæˆ–å°†å…¶ `p=0`ã€‚

## ä¿®æ”¹è®°å½•

### v2.0 (å½“å‰ç‰ˆæœ¬)
- âœ… æ–°å¢žå®‰å…¨æ¨¡å¼å’Œæ¿€è¿›æ¨¡å¼ä¸¤ç§æ–¹æ¡ˆ
- âœ… ä¼˜åŒ–bbox_paramså‚æ•°ï¼Œé™ä½Žä¸¢å¤±çŽ‡
- âœ… æ–°å¢žè¯¦ç»†çš„bboxä¿ç•™ç»Ÿè®¡
- âœ… æ–°å¢žæ™ºèƒ½é‡è¯•æœºåˆ¶ï¼ˆ5æ¬¡ï¼‰
- âœ… æ–°å¢žå®žæ—¶è¿›åº¦æ˜¾ç¤º
- âœ… æ–°å¢žè­¦å‘Šæç¤º

### v1.0 (åŽŸå§‹ç‰ˆæœ¬)
- RandomCropå¯¼è‡´å¤§é‡bboxä¸¢å¤±
- ç¼ºä¹ç»Ÿè®¡ä¿¡æ¯
- é‡è¯•æ¬¡æ•°å°‘ï¼ˆ3æ¬¡ï¼‰

